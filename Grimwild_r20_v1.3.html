<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab" value="main" />
	<div class="sheet-container">
	    <div class="sheet-notebook-tabs">
			<button type="action" name="act_main" class="sheet-notebook-tab sheet-button0">Main</button>
            <button type="action" name="act_notes" class="sheet-notebook-tab sheet-button1">Notes</button>
            <button type="action" name="act_settings" class="sheet-notebook-tab sheet-button2 settings-tab">
				<span class="gear-icon"></span>
            </button>
        </div>
		<div class="sheet-main">
			<div class="top-row">
				<div class="name-section">
					<div class="name-section-header"></div>
					<div class="name-section-content">
						<div class="name-left-side">
							<div class="name-top-fields">
								<div class="name-field-group">
									<div class="name-field-label">NAME</div>
									<input type="text" class="name-text-input-main" name="attr_character_name" placeholder="">
								</div>
							</div>
							
							<div class="name-bottom-fields">
								<div class="name-field-group name-field-small">
									<div class="name-field-label">PATH</div>
									<input type="text" class="name-text-input" name="attr_player_name" placeholder="">
								</div>
								<div class="name-field-group name-field-small">
									<div class="name-field-label">PLAYER</div>
									<input type="text" class="name-text-input" name="attr_second" placeholder="">
								</div>
							</div>
						</div>
						
						<div class="name-right-side">
							<div class="name-field-group">
								<div class="name-field-label">DISTINCTIVE FEATURES</div>
								<textarea class="name-text-area" name="attr_distinctive_features" placeholder=""></textarea>
							</div>
						</div>
					</div>            
				</div>
				<div class="logo-section">
					<img src="https://imgur.com/KKRe2oc.jpg" alt="Grimwild Logo" class="grimwild-logo">
				</div>
			</div>
			<div class="main-content">
				<div class="left-column">
					<div class="stats-section">
						<div class="stats-content">
							<div class="stats-row">
								<div class="stat-group">
									<button type="action" name="act_roll_brawn" class="stat-name">Brawn</button>
									<div class="stat-container">
										<div class="stat-square">
											<input type="text" name="attr_brawn" class="stat-input" />
										</div>
										<div class="stat-diamond">
											<input type="checkbox" name="attr_brawn_marked" />
										</div>
									</div>
								</div>
								<div class="stat-group">
									<button type="action" name="act_roll_agility" class="stat-name">Agility</button>
									<div class="stat-container">
										<div class="stat-square">
											<input type="text" name="attr_agility" class="stat-input" />
										</div>
										<div class="stat-diamond">
											<input type="checkbox" name="attr_agility_marked" />
										</div>
									</div>
								</div>
								<div class="stat-group">
									<button type="action" name="act_roll_wits" class="stat-name">Wits</button>
									<div class="stat-container">
										<div class="stat-square">
											<input type="text" name="attr_wits" class="stat-input" />
										</div>
										<div class="stat-diamond">
											<input type="checkbox" name="attr_wits_marked" />
										</div>
									</div>
								</div>
								<div class="stat-group">
									<button type="action" name="act_roll_presence" class="stat-name">Presence</button>
									<div class="stat-container">
										<div class="stat-square">
											<input type="text" name="attr_presence" class="stat-input" />
										</div>
										<div class="stat-diamond">
											<input type="checkbox" name="attr_presence_marked" />
										</div>
									</div>
								</div>
							</div>
							<div class="conditions-section">
								<div class="conditions-row">
									<div class="condition-group">
										<div class="condition-diamond">
											<input type="checkbox" name="attr_bloodied" />
										</div>
										<div class="condition-label">BLOODIED</div>
									</div>
									<div class="condition-group">
										<div class="condition-diamond">
											<input type="checkbox" name="attr_rattled" />
										</div>
										<div class="condition-label">RATTLED</div>
									</div>
								</div>
								<button type="action" name="act_roll_dropped" class="dropped-button">DROPPED</button>
							</div>

							<div class="bottom-controls">
								<div class="control-group">
									<div class="control-label">Add Thorns</div>
									<div class="increment-control">
										<button type="action" name="act_thorns_decrement" class="increment-btn">−</button>
										<span name="attr_thorns" class="increment-display"></span>
										<input type="hidden" name="attr_thorns" value="0">
										<button type="action" name="act_thorns_increment" class="increment-btn">+</button>
									</div>
								</div>
							
								<div class="control-group">
									<div class="control-label">Use Spark</div>
									<div class="spark-checkbox">
										<input type="checkbox" name="attr_using_spark" />
									</div>
								</div>
							
								<div class="control-group">
									<div class="control-label">Add Dice</div>
									<div class="increment-control">
										<button type="action" name="act_extra_dice_decrement" class="increment-btn">−</button>
										<span name="attr_extra_dice" class="increment-display">0</span>
										<input type="hidden" name="attr_extra_dice" value="0">
										<button type="action" name="act_extra_dice_increment" class="increment-btn">+</button>
									</div>
								</div>
							</div>
						</div>
						<div class="stats-conditions-overlay"></div> 
					</div>

					<div class="character-details">
						<div class="section-header">
							CHARACTER DETAILS
							<div class="header-instruction">INTRODUCE A TANGLE: TAKE SPARK</div>
						</div>
						
						<div class="section-content">
							<div class="field-group">
								<div class="backgrounds-wises-header">
									<div class="backgrounds-column">BACKGROUNDS</div>
									<div class="wises-column">WISES</div>
								</div>

								<div class="backgrounds-wises-list">
									<div class="backgrounds-wises-row">
										<div class="backgrounds-cell">
											<textarea class="backgrounds-input" name="attr_background_1" placeholder=""></textarea>
										</div>
										<div class="wises-cell">
											<textarea class="wises-input" name="attr_wise_1" placeholder=""></textarea>
										</div>
									</div>
									<div class="backgrounds-wises-row">
										<div class="backgrounds-cell">
											<textarea class="backgrounds-input" name="attr_background_2" placeholder=""></textarea>
										</div>
										<div class="wises-cell">
											<textarea class="wises-input" name="attr_wise_2" placeholder=""></textarea>
										</div>
									</div>
								</div>
							</div>
							<div class="traits-section">
								<div class="trait-header">TRAITS:&nbsp 2 you are (●)  &nbsp|&nbsp  1 you're really not (×)</div>
								<div class="trait-grid">
									<div class="trait-item">
										<button type="action" name="act_cycle_trait_brave" class="trait-button">
											<div class="trait-checkbox" data-trait="brave"></div>
											<span>Brave</span>
										</button>
										<input type="hidden" name="attr_trait_brave" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_trait_gentle" class="trait-button">
											<div class="trait-checkbox" data-trait="gentle"></div>
											<span>Gentle</span>
										</button>
										<input type="hidden" name="attr_trait_gentle" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_trait_protective" class="trait-button">
											<div class="trait-checkbox" data-trait="protective"></div>
											<span>Protective</span>
										</button>
										<input type="hidden" name="attr_trait_protective" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_trait_caring" class="trait-button">
											<div class="trait-checkbox" data-trait="caring"></div>
											<span>Caring</span>
										</button>
										<input type="hidden" name="attr_trait_caring" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_trait_honest" class="trait-button">
											<div class="trait-checkbox" data-trait="honest"></div>
											<span>Honest</span>
										</button>
										<input type="hidden" name="attr_trait_honest" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_trait_quiet" class="trait-button">
											<div class="trait-checkbox" data-trait="quiet"></div>
											<span>Quiet</span>
										</button>
										<input type="hidden" name="attr_trait_quiet" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_trait_confident" class="trait-button">
											<div class="trait-checkbox" data-trait="confident"></div>
											<span>Confident</span>
										</button>
										<input type="hidden" name="attr_trait_confident" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_trait_honorable" class="trait-button">
											<div class="trait-checkbox" data-trait="honorable"></div>
											<span>Honorable</span>
										</button>
										<input type="hidden" name="attr_trait_honorable" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_trait_rash" class="trait-button">
											<div class="trait-checkbox" data-trait="rash"></div>
											<span>Rash</span>
										</button>
										<input type="hidden" name="attr_trait_rash" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_trait_curious" class="trait-button">
											<div class="trait-checkbox" data-trait="curious"></div>
											<span>Curious</span>
										</button>
										<input type="hidden" name="attr_trait_curious" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_trait_persistent" class="trait-button">
											<div class="trait-checkbox" data-trait="persistent"></div>
											<span>Persistent</span>
										</button>
										<input type="hidden" name="attr_trait_persistent" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_trait_stubborn" class="trait-button">
											<div class="trait-checkbox" data-trait="stubborn"></div>
											<span>Stubborn</span>
										</button>
										<input type="hidden" name="attr_trait_stubborn" value="0" class="trait-value">
									</div>
								</div>
								
								<div class="custom-trait">
									<div class="trait-item" style="margin-right: 10px;">
										<button type="action" name="act_cycle_trait_custom" class="trait-button">
											<div class="trait-checkbox" data-trait="custom"></div>
										</button>
										<input type="hidden" name="attr_trait_custom_state" value="0" class="trait-value">
									</div>
									<input type="text" name="attr_trait_custom" placeholder="">
								</div>

								<div class="trait-header" style="margin-top: 20px;">DESIRES: 2 you want (●)  &nbsp|&nbsp  1 you really don't (×)</div>
								<div class="trait-grid">
									<div class="trait-item">
										<button type="action" name="act_cycle_desire_belonging" class="trait-button">
											<div class="trait-checkbox" data-trait="belonging"></div>
											<span>Belonging</span>
										</button>
										<input type="hidden" name="attr_desire_belonging" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_desire_justice" class="trait-button">
											<div class="trait-checkbox" data-trait="justice"></div>
											<span>Justice</span>
										</button>
										<input type="hidden" name="attr_desire_justice" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_desire_renown" class="trait-button">
											<div class="trait-checkbox" data-trait="renown"></div>
											<span>Renown</span>
										</button>
										<input type="hidden" name="attr_desire_renown" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_desire_glory" class="trait-button">
											<div class="trait-checkbox" data-trait="glory"></div>
											<span>Glory</span>
										</button>
										<input type="hidden" name="attr_desire_glory" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_desire_knowledge" class="trait-button">
											<div class="trait-checkbox" data-trait="knowledge"></div>
											<span>Knowledge</span>
										</button>
										<input type="hidden" name="attr_desire_knowledge" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_desire_thrills" class="trait-button">
											<div class="trait-checkbox" data-trait="thrills"></div>
											<span>Thrills</span>
										</button>
										<input type="hidden" name="attr_desire_thrills" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_desire_harmony" class="trait-button">
											<div class="trait-checkbox" data-trait="harmony"></div>
											<span>Harmony</span>
										</button>
										<input type="hidden" name="attr_desire_harmony" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_desire_love" class="trait-button">
											<div class="trait-checkbox" data-trait="love"></div>
											<span>Love</span>
										</button>
										<input type="hidden" name="attr_desire_love" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_desire_wealth" class="trait-button">
											<div class="trait-checkbox" data-trait="wealth"></div>
											<span>Wealth</span>
										</button>
										<input type="hidden" name="attr_desire_wealth" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_desire_honor" class="trait-button">
											<div class="trait-checkbox" data-trait="honor"></div>
											<span>Honor</span>
										</button>
										<input type="hidden" name="attr_desire_honor" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_desire_power" class="trait-button">
											<div class="trait-checkbox" data-trait="power"></div>
											<span>Power</span>
										</button>
										<input type="hidden" name="attr_desire_power" value="0" class="trait-value">
									</div>
									
									<div class="trait-item">
										<button type="action" name="act_cycle_desire_wisdom" class="trait-button">
											<div class="trait-checkbox" data-trait="wisdom"></div>
											<span>Wisdom</span>
										</button>
										<input type="hidden" name="attr_desire_wisdom" value="0" class="trait-value">
									</div>
								</div>
								
								<div class="custom-trait">
									<div class="trait-item" style="margin-right: 10px;">
										<button type="action" name="act_cycle_desire_custom" class="trait-button">
											<div class="trait-checkbox" data-trait="custom_desire"></div>
										</button>
										<input type="hidden" name="attr_desire_custom_state" value="0" class="trait-value">
									</div>
									<input type="text" name="attr_desire_custom" placeholder="">
								</div>
							</div>
						</div>
					</div>

					<div class="bonds-section">
						<div class="section-header">
							BONDS
							<div class="header-instruction">CHANGE A BOND: THE OTHER PC TAKES SPARK <br> QUARREL: BOTH TAKE SPARK</div>
						</div>
						
						<div class="section-content">
							<div class="bonds-header">
								<div class="pc-column">PC</div>
								<div class="bond-column">&emsp;&emsp;BOND</div>
							</div>
							
							<div class="bonds-list">
								<div class="bond-row">
									<div class="pc-cell">
										<textarea class="pc-input" name="attr_bond_pc_1" placeholder=""></textarea>
									</div>
									<div class="bond-cell">
										<textarea class="bond-input" name="attr_bond_1" placeholder=""></textarea>
									</div>
								</div>
								<div class="bond-row">
									<div class="pc-cell">
										<textarea class="pc-input" name="attr_bond_pc_2" placeholder=""></textarea>
									</div>
									<div class="bond-cell">
										<textarea class="bond-input" name="attr_bond_2" placeholder=""></textarea>
									</div>
								</div>
								<div class="bond-row">
									<div class="pc-cell">
										<textarea class="pc-input" name="attr_bond_pc_3" placeholder=""></textarea>
									</div>
									<div class="bond-cell">
										<textarea class="bond-input" name="attr_bond_3" placeholder=""></textarea>
									</div>
								</div>
								<div class="bond-row">
									<div class="pc-cell">
										<textarea class="pc-input" name="attr_bond_pc_4" placeholder=""></textarea>
									</div>
									<div class="bond-cell">
										<textarea class="bond-input" name="attr_bond_4" placeholder=""></textarea>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				
				<div class="right-column">
					<div class="conditions-notes">
						<div class="conditions-notes-header">
							CONDITIONS & WOUNDS
							<div class="header-instruction">MARK: +1t, THEN CLEAR<br>HARM: +1t TO ALL ROLLS</div>
						</div>
						<div class="conditions-notes-content">
							<textarea name="attr_conditions_notes" class="notes-textarea" placeholder=""></textarea>
							<div class="vex-text"><b>VEX:</b> FIGHT&nbsp;—&nbsp;FLIGHT&nbsp;—&nbsp;FREEZE&nbsp;—&nbsp;FREAKOUT</div>
						</div>
					</div>

					<div class="pool-section">
						<div class="pool-group-left">
							 <div class="pool-label"></div>
							 <button type="action" name="act_assist" class="roll-button">ASSIST</button>
						</div>
						<div class="pool-group-mid">
							<div class="pool-label">BUILD POOL</div>
							<div class="increment-control">
								<button type="action" name="act_pool_decrement" class="increment-btn">−</button>
								<span name="attr_pool_value" class="increment-display">0</span>
								<input type="hidden" name="attr_pool_value" value="0">
								<button type="action" name="act_pool_increment" class="increment-btn">+</button>
							</div>
						</div>
						<div class="pool-group-right">
							 <div class="pool-label"></div>
							 <button type="action" name="act_roll_pool" class="roll-button">ROLL POOL</button>
						</div>
					</div>

					<div class="counters-section">
						<div class="counter-group">
							<span class="counter-name">SPARK</span>
							<div class="counter-boxes">
								<div class="counter-box">
									<input type="checkbox" name="attr_spark1" />
								</div>
								<div class="counter-box">
									<input type="checkbox" name="attr_spark2" />
								</div>
							</div>
						</div>
						<div class="counter-group">
							<span class="counter-name">STORY</span>
							<div class="counter-boxes">
								<div class="counter-box">
									<input type="checkbox" name="attr_story1" />
								</div>
								<div class="counter-box">
									<input type="checkbox" name="attr_story2" />
								</div>
							</div>
						</div>
						<div class="counter-button">
						   <button type="action" name="act_roll_story" class="roll-button">Story Roll</button>
						</div>
					</div>
	   
					<div class="adventurer-section">
						<div class="section-header">
							TALENTS
						</div>
						
						<div class="section-content">
							<div class="subsection">
								<div class="subsection-header">
									CORE TALENT
									<div class="talent-container">
										<input type="hidden" name="attr_core_talent_resize_unlocked" value="false">
										<button type="action" name="act_toggle_core_talent_resize" class="resize-toggle-btn" title="Toggle resize mode"></button>
									</div>
								</div>
								<div class="subsection-content">
									<textarea class="core-talent-area" name="attr_core_talent" placeholder="TALENT NAME&#10;Talent description.&#10;&#10;INSTRUCTIONS: First line automatically formats as a heading. Save by clicking out of the box. Reopen editor by clicking the text. Lock toggles free resizing."></textarea>
								</div>
							</div>
							
							<div class="subsection">
								<div class="subsection-header">
									ACQUIRED TALENTS
									<div class="talent-container">
										<input type="hidden" name="attr_acquired_talents_resize_unlocked" value="false">
										<button type="action" name="act_toggle_acquired_talents_resize" class="resize-toggle-btn" title="Toggle resize mode"></button>
									</div>
								</div>
								<div class="subsection-content">
									<fieldset class="repeating_talents">
										<div class="talent-slot-container">
											<textarea class="talent-slot" name="attr_talent_text" placeholder="TALENT NAME&#10;Talent description.&#10;&#10;INSTRUCTIONS: First line automatically formats as a heading. Save by clicking out of the box. Reopen editor by clicking the text. Lock toggles free resizing."></textarea>
										</div>
									</fieldset>
								</div>
							</div>
						</div>
					</div>

					<div class="resources-section">
						<div class="section-header">
							RESOURCES
						</div>
						<div class="section-content">
							<fieldset class="repeating_items">
								<div class="items-row">
									<div class="resource-box">
										<input type="text" class="resource-name-input" name="attr_item_1_name" placeholder="Name">
										<div class="resource-count-container">
											<input type="number" class="resource-count-input" name="attr_item_1_count" value="0" min="0">
										</div>
										<input type="text" class="resource-notes-input" name="attr_item_1_notes" placeholder="Notes">
									</div>
									<div class="resource-box">
										<input type="text" class="resource-name-input" name="attr_item_2_name" placeholder="Name">
										<div class="resource-count-container">
											<input type="number" class="resource-count-input" name="attr_item_2_count" value="0" min="0">
										</div>
										<input type="text" class="resource-notes-input" name="attr_item_2_notes" placeholder="Notes">
									</div>
									<div class="resource-box">
										<input type="text" class="resource-name-input" name="attr_item_3_name" placeholder="Name">
										<div class="resource-count-container">
											<input type="number" class="resource-count-input" name="attr_item_3_count" value="0" min="0">
										</div>
										<input type="text" class="resource-notes-input" name="attr_item_3_notes" placeholder="Notes">
									</div>
									<div class="resource-box">
										<input type="text" class="resource-name-input" name="attr_item_4_name" placeholder="Name">
										<div class="resource-count-container">
											<input type="number" class="resource-count-input" name="attr_item_4_count" value="0" min="0">
										</div>
										<input type="text" class="resource-notes-input" name="attr_item_4_notes" placeholder="Notes">
									</div>
								</div>
							</fieldset>
						</div>
					</div>

					<div class="story-experience-row">
						<div class="story-arcs-section">
							<div class="section-header">
								STORY ARCS
								<div class="header-instruction">FINISH/MOVE ON FROM<br> AN ARC: TAKE SPARK</div>
							</div>
							
							<div class="section-content">
								<div class="subsection">
									<div class="subsection-header">GROUP ARC</div>
									<div class="subsection-content">
										<textarea class="arc-area" name="attr_group_arc" placeholder=""></textarea>
									</div>
								</div>
								
								<div class="subsection">
									<div class="subsection-header">CHARACTER ARC</div>
									<div class="subsection-content">
										<textarea class="arc-area" name="attr_character_arc" placeholder=""></textarea>
									</div>
								</div>
							</div>
						</div>

						<div class="experience-section">
							<div class="section-header">
								EXPERIENCE
							</div>
							
							<div class="section-content">
								<div class="xp-instruction">Each session, take 1 XP:</div>
								
								<div class="xp-tracks">
									<div class="xp-track">
										<div class="checkbox-group">
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_1_1" value="1">
											</div>
											<div class="xp-checkbox plus-box">
												<input type="checkbox" name="attr_xp_1_2" value="1">
											</div>
										</div>
									</div>
									<div class="xp-track">
										<div class="checkbox-group">
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_2_1" value="1">
											</div>
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_2_2" value="1">
											</div>
											<div class="xp-checkbox plus-box">
												<input type="checkbox" name="attr_xp_2_3" value="1">
											</div>
										</div>
									</div>
									<div class="xp-track">
										<div class="checkbox-group">
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_3_1" value="1">
											</div>
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_3_2" value="1">
											</div>
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_3_3" value="1">
											</div>
											<div class="xp-checkbox plus-box">
												<input type="checkbox" name="attr_xp_3_4" value="1">
											</div>
										</div>
									</div>
									<div class="xp-track">
										<div class="checkbox-group">
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_4_1" value="1">
											</div>
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_4_2" value="1">
											</div>
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_4_3" value="1">
											</div>
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_4_4" value="1">
											</div>
											<div class="xp-checkbox plus-box">
												<input type="checkbox" name="attr_xp_4_5" value="1">
											</div>
										</div>
									</div>
									<div class="xp-track">
										<div class="checkbox-group">
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_5_1" value="1">
											</div>
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_5_2" value="1">
											</div>
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_5_3" value="1">
											</div>
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_5_4" value="1">
											</div>
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_5_5" value="1">
											</div>
											<div class="xp-checkbox plus-box">
												<input type="checkbox" name="attr_xp_5_6" value="1">
											</div>
										</div>
									</div>
									<div class="xp-track">
										<div class="checkbox-group">
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_6_1" value="1">
											</div>
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_6_2" value="1">
											</div>
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_6_3" value="1">
											</div>
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_6_4" value="1">
											</div>
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_6_5" value="1">
											</div>
											<div class="xp-checkbox">
												<input type="checkbox" name="attr_xp_6_6" value="1">
											</div>
											<div class="xp-checkbox plus-box">
												<input type="checkbox" name="attr_xp_6_7" value="1">
											</div>
										</div>
									</div>
								</div>
								
								<div class="talent-instruction">At +, take a new talent.</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="sheet-notes">
			<div class="top-row">
				<div class="name-section">
					<div class="name-section-header"></div>
					<div class="name-section-content">
						<div class="name-left-side">
							<div class="name-top-fields">
								<div class="name-field-group">
									<div class="name-field-label">NAME</div>
									<input type="text" class="name-text-input-main" name="attr_character_name" placeholder="">
								</div>
							</div>
							
							<div class="name-bottom-fields">
								<div class="name-field-group name-field-small">
									<div class="name-field-label">PATH</div>
									<input type="text" class="name-text-input" name="attr_player_name" placeholder="">
								</div>
								<div class="name-field-group name-field-small">
									<div class="name-field-label">PLAYER</div>
									<input type="text" class="name-text-input" name="attr_second" placeholder="">
								</div>
							</div>
						</div>
						
						<div class="name-right-side">
							<div class="name-field-group">
								<div class="name-field-label">DISTINCTIVE FEATURES</div>
								<textarea class="name-text-area" name="attr_distinctive_features" placeholder=""></textarea>
							</div>
						</div>
					</div>            
				</div>
				<div class="logo-section">
					<img src="https://imgur.com/KKRe2oc.jpg" alt="Grimwild Logo" class="grimwild-logo">
				</div>
			</div>
			<div class="main-content">
				<div class="left-column">
					<div class="treasure-section">
						<div class="section-header">TREASURE
							<div class="header-instruction">CAROUSE: MINOR TREASURE FOR PARTY MONTAGE, TAKE SPARK</div>
						</div>
							<div class="section-content">
								<div class="treasure-row">
									<div class="treasure-box">
										<div class="treasure-name">MINOR</div>
										<div class="treasure-count-container">
											<input type="number" class="treasure-count-input" name="attr_treasure_minor" value="0" min="0">
										</div>
									</div>
									<div class="treasure-box">
										<div class="treasure-name">MAJOR</div>
										<div class="treasure-count-container">
											<input type="number" class="treasure-count-input" name="attr_treasure_major" value="0" min="0">
										</div>
									</div>
									<div class="treasure-box">
										<div class="treasure-name">MYTHIC</div>
										<div class="treasure-count-container">
											<input type="number" class="treasure-count-input" name="attr_treasure_mythic" value="0" min="0">
										</div>
									</div>
								</div>
								<div class="subsection-header">
								TREASURE NOTES
								</div>	
									<textarea name="attr_treasure_notes" class="treasure-textarea" placeholder=""></textarea>
							</div>
					</div>
					<div class="arcana-section">
						<div class="section-header">ARCANA</div>
						<div class="section-content">
							<fieldset class="repeating_arcana">
								<div class="arcana-item">
									<div class="arcana-header-row">
										<div class="arcana-name-cell">
											<input type="text" class="arcana-name-input" name="attr_arcana_name" placeholder="Arcana Name">
										</div>
										<div class="arcana-tier-cell">
											<select class="arcana-tier-select" name="attr_arcana_tier">
												<option value="Minor">MINOR</option>
												<option value="Major">MAJOR</option>
												<option value="Mythic">MYTHIC</option>
											</select>
										</div>
									</div>
									<div class="arcana-field-group">
										<textarea class="arcana-description" name="attr_arcana_description" placeholder="Description of the arcana and its effects"></textarea>
									</div>
									
									<div class="arcana-field-group">
										<div class="arcana-field-label">LIMITATIONS</div>
										<textarea class="arcana-textarea" name="attr_arcana_limitations" placeholder="The factors that limit the use of the arcana"></textarea>
									</div>
									
									<div class="arcana-field-group">
										<div class="arcana-field-label">TOUCHSTONES</div>
										<textarea class="arcana-textarea" name="attr_arcana_touchstones" placeholder="E.g., Balance — Refuge — Time"></textarea>
									</div>
								</div>
							</fieldset>
						</div>
					</div>
				</div>	
				<div class="right-column">
					<div class="adventurer-section">
						<div class="section-header">
							SPELLCRAFT
						</div>
						
						<div class="section-content">
							<div class="subsection">
								<div class="subsection-header">
									SOURCE OF SPELLCRAFT
									<div class="spell-container">
										<input type="hidden" name="attr_spell_source_resize_unlocked" value="false">
										<button type="action" name="act_toggle_spell_source_resize" class="resize-toggle-btn" title="Toggle resize mode"></button>
									</div>
								</div>
								<div class="subsection-content">
									<textarea class="spell-source-area" name="attr_spell_source" placeholder="SOURCE&#10;Description. (Examples of sources include Wizardry, Sorcery, Pacts, etc.)"></textarea>
								</div>
							</div>
							
							<div class="subsection">
								<div class="subsection-header">
									SPELLS & TOUCHSTONES
									<div class="spell-container">
										<input type="hidden" name="attr_spells_resize_unlocked" value="false">
										<button type="action" name="act_toggle_spells_resize" class="resize-toggle-btn" title="Toggle resize mode"></button>
									</div>
								</div>
								<div class="subsection-content">
									<fieldset class="repeating_spells">
										<div class="spell-slot-container">
											<textarea class="spell-slot" name="attr_spell_text" placeholder="TOUCHSTONES&#10;Description and additional notes."></textarea>
										</div>
									</fieldset>
								</div>
							</div>
						</div>
					</div>
						<div class="pools-section">
							<div class="section-header">POOLS
								<div class="header-instruction">POOL SIZES: 4d|SHORT, 6d|MID, 8d|LONG</div>
							</div>
							<div class="section-content">
								<div class="pools-header">
									<div class="pool-name-column">NAME</div>
									<div class="pool-total-column">TOTAL</div>
									<div class="pool-current-column">CURRENT</div>
									<div class="pool-roll-column">ROLL</div>
								</div>
								
								<fieldset class="repeating_pools">
									<div class="pool-row">
										<div class="pool-name-cell">
											<input type="text" class="pool-name-input" name="attr_pool_name" placeholder="Custom Pool" maxlength="22">
										</div>
										<div class="pool-total-cell">
											<input type="number" class="pool-number-input" name="attr_pool_total" value="0" min="0" max="8">
										</div>
										<div class="pool-current-cell">
											<input type="number" class="pool-number-input" name="attr_pool_current" value="0" min="0" max="8">
										</div>
										<div class="pool-roll-cell">
											<button type="action" name="act_roll-custom-pool" class="pool-roll-button">&#x1F3B2;</button>
										</div>
									</div>
								</fieldset>
							</div>
						</div>
				</div>
			
			</div>	
				<div class="notes-section">
					<div class="section-header">GENERAL NOTES</div>
					<div class="section-content">
						<div class="notes-columns">
							<textarea name="attr_full_notes_1" class="notes-column" placeholder=""></textarea>
							<textarea name="attr_full_notes_2" class="notes-column" placeholder=""></textarea>
							<textarea name="attr_full_notes_3" class="notes-column" placeholder=""></textarea>
						</div>
					</div>
				</div>	
        </div>
		<div class="sheet-settings">
			<div class="top-row">
				<div class="name-section">
					<div class="name-section-header"></div>
					<div class="name-section-content">
						<div class="name-left-side">
							<div class="name-top-fields">
								<div class="name-field-group">
									<div class="name-field-label">NAME</div>
									<input type="text" class="name-text-input-main" name="attr_character_name" placeholder="">
								</div>
							</div>
							
							<div class="name-bottom-fields">
								<div class="name-field-group name-field-small">
									<div class="name-field-label">PATH</div>
									<input type="text" class="name-text-input" name="attr_player_name" placeholder="">
								</div>
								<div class="name-field-group name-field-small">
									<div class="name-field-label">PLAYER</div>
									<input type="text" class="name-text-input" name="attr_second" placeholder="">
								</div>
							</div>
						</div>
						
						<div class="name-right-side">
							<div class="name-field-group">
								<div class="name-field-label">DISTINCTIVE FEATURES</div>
								<textarea class="name-text-area" name="attr_distinctive_features" placeholder=""></textarea>
							</div>
						</div>
					</div>            
				</div>
				<div class="logo-section">
					<img src="https://imgur.com/KKRe2oc.jpg" alt="Grimwild Logo" class="grimwild-logo">
				</div>
			</div>
				<div class="main-content">
					<div class="left-column">
						<div class="section-header">ROLL SETTINGS</div>
							<div class="section-content">
								<div class="field-group">
									<label class="settings-label-flex">
										<input type="checkbox" name="attr_use_api_rolls" checked="checked">
										<span>Use API Rolls</span>
									</label>
									<div class="settings-help-text">
										Enable when using the Grimwild Roll20 Character Sheet API to enhance how rolls are displayed and autocalculate results.
									</div>
								</div>
								<div class="field-group">
									<label class="settings-label-flex">
										<input type="checkbox" name="attr_use_rollable_tables" checked="">
										<span>Use Rollable Tables (when API is disabled)</span>
									</label>
									<div class="settings-help-text">
										Enable when using Roll20 rollable tables instead of standard d6 or d8 rolls.
									</div>
								</div>
								<div class="field-group">
									<label class="settings-label-flex">
										<input type="checkbox" name="attr_clean_story_assist" checked="">
										<span>Use Unaltered Story, Assist, and Montage Rolls</span>
									</label>
									<div class="settings-help-text">
										Enable if you don't want added thorns, dice, and spark to affect story, assist, and montage rolls.
									</div>
								</div>
							</div>
					</div>
					<div class="right-column">	
						<div class="section-header">SHEET SETTINGS</div>
							<div class="section-content">
								<div class="field-group">
									<label class="settings-label-block">
										<span class="settings-label-title">Sheet Size</span>
									</label>
									<div class="settings-radio-group">
										<label class="settings-radio-option">
											<input type="radio" name="attr_sheet_size" value="compact">
											<span>Compact</span>
										</label>
										<label class="settings-radio-option">
											<input type="radio" name="attr_sheet_size" value="regular" checked="checked">
											<span>Default</span>
										</label>
										<label class="settings-radio-option">
											<input type="radio" name="attr_sheet_size" value="expanded">
											<span>Expanded</span>
										</label>
									</div>
									<div class="settings-help-text-spaced">
										Adjust the overall size of the character sheet.
									</div>
								</div>
							</div>
					</div>
				</div>	
        </div>
    </div>
<script type="text/worker">
	on('sheet:opened', function() {
		getAttrs(['sheet_size', 'use_api_rolls'], function(values) {
			let updates = {};
			
			if (!values.sheet_size) {
				updates.sheet_size = 'regular';
			}
			
		if (!values.use_api_rolls) {
			updates.use_api_rolls = 'on';
		}

		if (values.use_rollable_tables === undefined) {
			updates.use_rollable_tables = '0';  
		}
			
			if (Object.keys(updates).length > 0) {
				setAttrs(updates);
			}
		});
		
		getSectionIDs('repeating_items', function(ids) {
			if (ids.length === 0) {
				const newRowId = generateRowID();
				const newRow = {};
				for (let i = 1; i <= 4; i++) {
					newRow[`repeating_items_${newRowId}_item_${i}_name`] = '';
					newRow[`repeating_items_${newRowId}_item_${i}_count`] = 0;
					newRow[`repeating_items_${newRowId}_item_${i}_notes`] = '';
				}
				setAttrs(newRow);
			}
		});
	});

	on('clicked:pool_increment', function() {
		getAttrs(['pool_value'], function(values) {
			const current = +values.pool_value || 0;
			if (current < 8) {
				const newValue = current + 1;
				setAttrs({
					pool_value: newValue
				});
				console.log("Pool set to:", newValue);
			}
		});
	});

	on('clicked:pool_decrement', function() {
		getAttrs(['pool_value'], function(values) {
			const current = +values.pool_value || 0;
			if (current > 0) {
				const newValue = current - 1;
				setAttrs({
					pool_value: newValue
				});
			}
		});
	});

	on('clicked:thorns_increment', function() {
		getAttrs(['thorns'], function(values) {
			const current = +values.thorns || 0;
			if (current < 3) {
				setAttrs({
					thorns: current + 1
				});
			}
		});
	});

	on('clicked:thorns_decrement', function() {
		getAttrs(['thorns'], function(values) {
			const current = +values.thorns || 0;
			if (current > 0) {
				setAttrs({
					thorns: current - 1
				});
			}
		});
	});

	on('clicked:extra_dice_increment', function() {
		getAttrs(['extra_dice'], function(values) {
			const current = +values.extra_dice || 0;
			if (current < 8) {
				setAttrs({
					extra_dice: current + 1
				});
			}
		});
	});

	on('clicked:extra_dice_decrement', function() {
		getAttrs(['extra_dice'], function(values) {
			const current = +values.extra_dice || 0;
			if (current > 0) {
				setAttrs({
					extra_dice: current - 1
				});
			}
		});
	});
	
	on('clicked:roll_pool', function() {
		getAttrs(['use_api_rolls', 'pool_value', 'character_name'], function(values) {
			const useAPI = values.use_api_rolls === 'on';
			const poolSize = +values.pool_value || 0;
			
			if (poolSize < 1) {
				console.log("Cannot roll pool - pool value must be at least 1");
				return;
			}
			
			if (poolSize > 8) {
				console.log("Cannot roll pool - maximum pool size is 8");
				return;
			}
			
			if (useAPI) {
				const apiCommand = `!grimpool ${poolSize}`;
				startRoll(apiCommand, function(results) {
					finishRoll(results.rollId, {});
				});
			} else {
				let rollString = `&{template:grimwild-basic} {{rollname=${values.character_name} | Pool Roll}} `;
				
				rollString += `{{main_dice=`;
				for (let i = 0; i < poolSize; i++) {
					if (i > 0) rollString += ` `;
					rollString += `[[1d6]]`;
				}
				rollString += `}} `;
				
				rollString += `{{pool_size=${poolSize}}} `;
				
				startRoll(rollString, function(results) {
					finishRoll(results.rollId, {});
				});
			}
		});
	});
	
on('clicked:roll_brawn', function() {
    getAttrs(['use_api_rolls'], function(values) {
        const useAPI = values.use_api_rolls === 'on';
        
        if (useAPI) {
            getAttrs(['brawn', 'thorns', 'extra_dice', 'brawn_marked', 'bloodied', 'rattled', 'using_spark'], function(values) {
                const stat = +values.brawn || 0;
                const difficultyThorns = +values.thorns || 0;
                const extraDice = +values.extra_dice || 0;
                const isMarked = values.brawn_marked === 'on';
                const isBloodied = values.bloodied === 'on';
                const isRattled = values.rattled === 'on';
                const usingSpark = values.using_spark === 'on';
                
                let markHarmThorns = 0;
                if (isMarked) markHarmThorns += 1;
                if (isBloodied) markHarmThorns += 1;
                if (isRattled) markHarmThorns += 1;
                
                const totalThorns = difficultyThorns + markHarmThorns;
                let totalDice = stat + extraDice;
                if (usingSpark) totalDice += 1;
                
                if (totalDice > 0) {
                    let apiCommand = `!grimwild ${totalDice} t${totalThorns} Brawn d${difficultyThorns} m${markHarmThorns} e${extraDice}`;
                    if (usingSpark) apiCommand += ` spark`;
                    if (isMarked) apiCommand += ` marked`;
                    
                    startRoll(apiCommand, function(results) {
                        finishRoll(results.rollId, {});
                        
                        let attrsToSet = {};
                        if (isMarked) attrsToSet.brawn_marked = '0';
                        if (usingSpark) attrsToSet.using_spark = '0';
                        if (Object.keys(attrsToSet).length > 0) setAttrs(attrsToSet);
                    });
                }
            });
        } else {
            rollAttribute('brawn');
        }
    });
});

		on('clicked:roll_agility', function() {
			getAttrs(['use_api_rolls'], function(values) {
				const useAPI = values.use_api_rolls === 'on';
				
				if (useAPI) {
					getAttrs(['agility', 'thorns', 'extra_dice', 'agility_marked', 'bloodied', 'rattled', 'using_spark'], function(values) {
						const stat = +values.agility || 0;
						const difficultyThorns = +values.thorns || 0;
						const extraDice = +values.extra_dice || 0;
						const isMarked = values.agility_marked === 'on';
						const isBloodied = values.bloodied === 'on';
						const isRattled = values.rattled === 'on';
						const usingSpark = values.using_spark === 'on';
						
						let markHarmThorns = 0;
						if (isMarked) markHarmThorns += 1;
						if (isBloodied) markHarmThorns += 1;
						if (isRattled) markHarmThorns += 1;
						
						const totalThorns = difficultyThorns + markHarmThorns;
						let totalDice = stat + extraDice;
						if (usingSpark) totalDice += 1;
						
						if (totalDice > 0) {
							let apiCommand = `!grimwild ${totalDice} t${totalThorns} Agility d${difficultyThorns} m${markHarmThorns} e${extraDice}`;
							if (usingSpark) apiCommand += ` spark`;
							if (isMarked) apiCommand += ` marked`;
							
							startRoll(apiCommand, function(results) {
								finishRoll(results.rollId, {});
								
								let attrsToSet = {};
								if (isMarked) attrsToSet.agility_marked = '0';
								if (usingSpark) attrsToSet.using_spark = '0';
								if (Object.keys(attrsToSet).length > 0) setAttrs(attrsToSet);
							});
						}
					});
				} else {
					rollAttribute('agility');
				}
			});
		});

on('clicked:roll_wits', function() {
    getAttrs(['use_api_rolls'], function(values) {
        const useAPI = values.use_api_rolls === 'on';
        
        if (useAPI) {
            getAttrs(['wits', 'thorns', 'extra_dice', 'wits_marked', 'bloodied', 'rattled', 'using_spark'], function(values) {
                const stat = +values.wits || 0;
                const difficultyThorns = +values.thorns || 0;
                const extraDice = +values.extra_dice || 0;
                const isMarked = values.wits_marked === 'on';
                const isBloodied = values.bloodied === 'on';
                const isRattled = values.rattled === 'on';
                const usingSpark = values.using_spark === 'on';
                
                let markHarmThorns = 0;
                if (isMarked) markHarmThorns += 1;
                if (isBloodied) markHarmThorns += 1;
                if (isRattled) markHarmThorns += 1;
                
                const totalThorns = difficultyThorns + markHarmThorns;
                let totalDice = stat + extraDice;
                if (usingSpark) totalDice += 1;
                
                if (totalDice > 0) {
                    let apiCommand = `!grimwild ${totalDice} t${totalThorns} Wits d${difficultyThorns} m${markHarmThorns} e${extraDice}`;
                    if (usingSpark) apiCommand += ` spark`;
                    if (isMarked) apiCommand += ` marked`;
                    
                    startRoll(apiCommand, function(results) {
                        finishRoll(results.rollId, {});
                        
                        let attrsToSet = {};
                        if (isMarked) attrsToSet.wits_marked = '0';
                        if (usingSpark) attrsToSet.using_spark = '0';
                        if (Object.keys(attrsToSet).length > 0) setAttrs(attrsToSet);
                    });
                }
            });
        } else {
            rollAttribute('wits');
        }
    });
});

on('clicked:roll_presence', function() {
    getAttrs(['use_api_rolls'], function(values) {
        const useAPI = values.use_api_rolls === 'on';
        
        if (useAPI) {
            getAttrs(['presence', 'thorns', 'extra_dice', 'presence_marked', 'bloodied', 'rattled', 'using_spark'], function(values) {
                const stat = +values.presence || 0;
                const difficultyThorns = +values.thorns || 0;
                const extraDice = +values.extra_dice || 0;
                const isMarked = values.presence_marked === 'on';
                const isBloodied = values.bloodied === 'on';
                const isRattled = values.rattled === 'on';
                const usingSpark = values.using_spark === 'on';
                
                let markHarmThorns = 0;
                if (isMarked) markHarmThorns += 1;
                if (isBloodied) markHarmThorns += 1;
                if (isRattled) markHarmThorns += 1;
                
                const totalThorns = difficultyThorns + markHarmThorns;
                let totalDice = stat + extraDice;
                if (usingSpark) totalDice += 1;
                
                if (totalDice > 0) {
                    let apiCommand = `!grimwild ${totalDice} t${totalThorns} Presence d${difficultyThorns} m${markHarmThorns} e${extraDice}`;
                    if (usingSpark) apiCommand += ` spark`;
                    if (isMarked) apiCommand += ` marked`;
                    
                    startRoll(apiCommand, function(results) {
                        finishRoll(results.rollId, {});
                        
                        let attrsToSet = {};
                        if (isMarked) attrsToSet.presence_marked = '0';
                        if (usingSpark) attrsToSet.using_spark = '0';
                        if (Object.keys(attrsToSet).length > 0) setAttrs(attrsToSet);
                    });
                }
            });
        } else {
            rollAttribute('presence');
        }
    });
});

	on('clicked:roll_story', function() {
		getAttrs(['use_api_rolls'], function(values) {
			const useAPI = values.use_api_rolls === 'on';
			
			if (useAPI) {
				getAttrs(['thorns', 'extra_dice', 'using_spark', 'clean_story_assist'], function(values) {
					const cleanMode = values.clean_story_assist === 'on';
					
					if (cleanMode) {
						const apiCommand = `!grimwild 0 menu Story d0 m0 e0`;
						
						startRoll(apiCommand, function(results) {
							finishRoll(results.rollId, {});
						});
					} else {
						const difficultyThorns = +values.thorns || 0;
						const extraDice = +values.extra_dice || 0;
						const usingSpark = values.using_spark === 'on';
						
						const apiCommand = `!grimwild 0 menu Story d${difficultyThorns} m0 e${extraDice}${usingSpark ? ' spark' : ''}`;
						
						startRoll(apiCommand, function(results) {
							finishRoll(results.rollId, {});
							
							if (usingSpark) {
								setAttrs({ using_spark: '0' });
							}
						});
					}
				});
			} else {
				rollStoryAdvanced();
			}
		});
	});
	
	on('clicked:cycle_trait_brave', function() {
		getAttrs(['trait_brave'], function(values) {
			let current = +values.trait_brave || 0;
			let next = (current + 1) % 3;
			setAttrs({
				trait_brave: next
			});
		});
	});

	on('clicked:cycle_trait_gentle', function() {
		getAttrs(['trait_gentle'], function(values) {
			let current = +values.trait_gentle || 0;
			let next = (current + 1) % 3;
			setAttrs({
				trait_gentle: next
			});
		});
	});

	on('clicked:cycle_trait_protective', function() {
		getAttrs(['trait_protective'], function(values) {
			let current = +values.trait_protective || 0;
			let next = (current + 1) % 3;
			setAttrs({
				trait_protective: next
			});
		});
	});

	on('clicked:cycle_trait_caring', function() {
		getAttrs(['trait_caring'], function(values) {
			let current = +values.trait_caring || 0;
			let next = (current + 1) % 3;
			setAttrs({
				trait_caring: next
			});
		});
	});

	on('clicked:cycle_trait_honest', function() {
		getAttrs(['trait_honest'], function(values) {
			let current = +values.trait_honest || 0;
			let next = (current + 1) % 3;
			setAttrs({
				trait_honest: next
			});
		});
	});

	on('clicked:cycle_trait_quiet', function() {
		getAttrs(['trait_quiet'], function(values) {
			let current = +values.trait_quiet || 0;
			let next = (current + 1) % 3;
			setAttrs({
				trait_quiet: next
			});
		});
	});

	on('clicked:cycle_trait_confident', function() {
		getAttrs(['trait_confident'], function(values) {
			let current = +values.trait_confident || 0;
			let next = (current + 1) % 3;
			setAttrs({
				trait_confident: next
			});
		});
	});

	on('clicked:cycle_trait_honorable', function() {
		getAttrs(['trait_honorable'], function(values) {
			let current = +values.trait_honorable || 0;
			let next = (current + 1) % 3;
			setAttrs({
				trait_honorable: next
			});
		});
	});

	on('clicked:cycle_trait_rash', function() {
		getAttrs(['trait_rash'], function(values) {
			let current = +values.trait_rash || 0;
			let next = (current + 1) % 3;
			setAttrs({
				trait_rash: next
			});
		});
	});

	on('clicked:cycle_trait_curious', function() {
		getAttrs(['trait_curious'], function(values) {
			let current = +values.trait_curious || 0;
			let next = (current + 1) % 3;
			setAttrs({
				trait_curious: next
			});
		});
	});

	on('clicked:cycle_trait_persistent', function() {
		getAttrs(['trait_persistent'], function(values) {
			let current = +values.trait_persistent || 0;
			let next = (current + 1) % 3;
			setAttrs({
				trait_persistent: next
			});
		});
	});

	on('clicked:cycle_trait_stubborn', function() {
		getAttrs(['trait_stubborn'], function(values) {
			let current = +values.trait_stubborn || 0;
			let next = (current + 1) % 3;
			setAttrs({
				trait_stubborn: next
			});
		});
	});

	on('clicked:cycle_trait_custom', function() {
		getAttrs(['trait_custom_state'], function(values) {
			let current = +values.trait_custom_state || 0;
			let next = (current + 1) % 3;
			setAttrs({
				trait_custom_state: next
			});
		});
	});

	on('clicked:cycle_desire_belonging', function() {
		getAttrs(['desire_belonging'], function(values) {
			let current = +values.desire_belonging || 0;
			let next = (current + 1) % 3;
			setAttrs({
				desire_belonging: next
			});
		});
	});

	on('clicked:cycle_desire_justice', function() {
		getAttrs(['desire_justice'], function(values) {
			let current = +values.desire_justice || 0;
			let next = (current + 1) % 3;
			setAttrs({
				desire_justice: next
			});
		});
	});

	on('clicked:cycle_desire_renown', function() {
		getAttrs(['desire_renown'], function(values) {
			let current = +values.desire_renown || 0;
			let next = (current + 1) % 3;
			setAttrs({
				desire_renown: next
			});
		});
	});

	on('clicked:cycle_desire_glory', function() {
		getAttrs(['desire_glory'], function(values) {
			let current = +values.desire_glory || 0;
			let next = (current + 1) % 3;
			setAttrs({
				desire_glory: next
			});
		});
	});

	on('clicked:cycle_desire_knowledge', function() {
		getAttrs(['desire_knowledge'], function(values) {
			let current = +values.desire_knowledge || 0;
			let next = (current + 1) % 3;
			setAttrs({
				desire_knowledge: next
			});
		});
	});

	on('clicked:cycle_desire_thrills', function() {
		getAttrs(['desire_thrills'], function(values) {
			let current = +values.desire_thrills || 0;
			let next = (current + 1) % 3;
			setAttrs({
				desire_thrills: next
			});
		});
	});

	on('clicked:cycle_desire_harmony', function() {
		getAttrs(['desire_harmony'], function(values) {
			let current = +values.desire_harmony || 0;
			let next = (current + 1) % 3;
			setAttrs({
				desire_harmony: next
			});
		});
	});

	on('clicked:cycle_desire_love', function() {
		getAttrs(['desire_love'], function(values) {
			let current = +values.desire_love || 0;
			let next = (current + 1) % 3;
			setAttrs({
				desire_love: next
			});
		});
	});

	on('clicked:cycle_desire_wealth', function() {
		getAttrs(['desire_wealth'], function(values) {
			let current = +values.desire_wealth || 0;
			let next = (current + 1) % 3;
			setAttrs({
				desire_wealth: next
			});
		});
	});

	on('clicked:cycle_desire_honor', function() {
		getAttrs(['desire_honor'], function(values) {
			let current = +values.desire_honor || 0;
			let next = (current + 1) % 3;
			setAttrs({
				desire_honor: next
			});
		});
	});

	on('clicked:cycle_desire_power', function() {
		getAttrs(['desire_power'], function(values) {
			let current = +values.desire_power || 0;
			let next = (current + 1) % 3;
			setAttrs({
				desire_power: next
			});
		});
	});

	on('clicked:cycle_desire_wisdom', function() {
		getAttrs(['desire_wisdom'], function(values) {
			let current = +values.desire_wisdom || 0;
			let next = (current + 1) % 3;
			setAttrs({
				desire_wisdom: next
			});
		});
	});

	on('clicked:cycle_desire_custom', function() {
		getAttrs(['desire_custom_state'], function(values) {
			let current = +values.desire_custom_state || 0;
			let next = (current + 1) % 3;
			setAttrs({
				desire_custom_state: next
			});
		});
	});
	
	on('clicked:rest', function() {
		setAttrs({
			brawn_marked: '0',
			agility_marked: '0',
			wits_marked: '0',
			presence_marked: '0',
			
			bloodied: '0',
			rattled: '0',
			
			thorns: 0,
			extra_dice: 0
		});
	});
	on('clicked:toggle_core_talent_resize', function() {
		getAttrs(['core_talent_resize_unlocked'], function(values) {
			const isCurrentlyUnlocked = values.core_talent_resize_unlocked === 'true';
			const newState = isCurrentlyUnlocked ? 'false' : 'true';
			
			setAttrs({
				core_talent_resize_unlocked: newState
			});
			
			console.log('Resize mode toggled to:', newState === 'true' ? 'UNLOCKED (manual resize)' : 'LOCKED (auto-size)');
		});
	});

on('clicked:toggle_acquired_talents_resize', function() {
    getAttrs(['acquired_talents_resize_unlocked'], function(values) {
        const isCurrentlyUnlocked = values.acquired_talents_resize_unlocked === 'true';
        const newState = isCurrentlyUnlocked ? 'false' : 'true';
        
        setAttrs({
            acquired_talents_resize_unlocked: newState
        });
        
        console.log('Acquired Talents resize mode toggled to:', newState === 'true' ? 'UNLOCKED' : 'LOCKED');
    });
	});

	on('sheet:opened', function() {
		setAttrs({
			core_talent_resize_unlocked: 'false',
			acquired_talents_resize_unlocked: 'false',
			spell_source_resize_unlocked: 'false',
			spells_resize_unlocked: 'false'
		});
		console.log('Sheet opened - all sections set to LOCKED mode (auto-size)');
	});
	const tabList = ["main", "notes", "settings"];

	tabList.forEach(tab => {
		on(`clicked:${tab}`, function() {
			setAttrs({
				sheetTab: tab
			});
		});
	});

	on('sheet:opened', function() {
		getAttrs(['sheetTab'], function(values) {
			if (!values.sheetTab) {
				setAttrs({
					sheetTab: 'main'
				});
			}
		});
		getSectionIDs('repeating_items', function(ids) {
		});
	});
on('clicked:assist', function() {
    getAttrs(['use_api_rolls', 'use_rollable_tables', 'clean_story_assist'], function(values) {
        const useAPI = values.use_api_rolls === 'on';
        const cleanMode = values.clean_story_assist === 'on';
        
        if (useAPI) {
            if (cleanMode) {
                const apiCommand = `!grimwild 1 t0 Assist d0 m0 e0`;
                
                startRoll(apiCommand, function(results) {
                    finishRoll(results.rollId, {});
                });
            } else {
                getAttrs(['using_spark'], function(sparkValues) {
                    const usingSpark = sparkValues.using_spark === 'on';
                    let totalDice = 1;
                    if (usingSpark) totalDice += 1;
                    
                    let apiCommand = `!grimwild ${totalDice} t0 Assist d0 m0 e0`;
                    if (usingSpark) apiCommand += ` spark`;
                    
                    startRoll(apiCommand, function(results) {
                        finishRoll(results.rollId, {});
                        
                        if (usingSpark) {
                            setAttrs({ using_spark: '0' });
                        }
                    });
                });
            }
        } else {
            if (cleanMode) {
                getAttrs(['character_name'], function(rollValues) {
                    const useRollableTables = values.use_rollable_tables === 'on';
                    
                    let rollString = `&{template:grimwild-basic} {{rollname=${rollValues.character_name} | Assist Roll}} `;
                    if (useRollableTables) {
                        rollString += `{{use_rollable_tables=1}} `;
                    }
                    rollString += `{{main_dice=`;
                    rollString += useRollableTables ? `[[1t[GWRoll]]]` : `[[1d6]]`;
                    rollString += `}}`;
                    
                    startRoll(rollString, function(results) {
                        finishRoll(results.rollId, {});
                    });
                });
            } else {
                getAttrs(['using_spark', 'character_name'], function(rollValues) {
                    const usingSpark = rollValues.using_spark === 'on';
                    const useRollableTables = values.use_rollable_tables === 'on';
                    let totalDice = 1;
                    if (usingSpark) totalDice += 1;
                    
                    let rollString = `&{template:grimwild-basic} {{rollname=${rollValues.character_name} | Assist Roll}} `;
                    if (useRollableTables) {
                        rollString += `{{use_rollable_tables=1}} `;
                    }
                    rollString += `{{main_dice=`;
                    for (let i = 0; i < totalDice; i++) {
                        if (i > 0) rollString += ` `;
                        rollString += useRollableTables ? `[[1t[GWRoll]]]` : `[[1d6]]`;
                    }
                    rollString += `}}`;
                    
                    startRoll(rollString, function(results) {
                        finishRoll(results.rollId, {});
                        
                        if (usingSpark) {
                            setAttrs({ using_spark: '0' });
                        }
                    });
                });
            }
        }
    });
});
on('clicked:repeating_pools:roll-custom-pool', function(eventInfo) {
    getAttrs(['use_api_rolls'], function(values) {
        const useAPI = values.use_api_rolls === 'on';
        const rowId = eventInfo.sourceAttribute.split('_')[2];
        
        if (useAPI) {
            getAttrs([
                `repeating_pools_${rowId}_pool_name`,
                `repeating_pools_${rowId}_pool_total`,
                `repeating_pools_${rowId}_pool_current`
            ], function(values) {
                const poolName = values[`repeating_pools_${rowId}_pool_name`] || 'Custom Pool';
                const poolTotal = parseInt(values[`repeating_pools_${rowId}_pool_total`]) || 0;
                const poolCurrent = parseInt(values[`repeating_pools_${rowId}_pool_current`]) || 0;
                
                let rollValue = poolCurrent > 0 ? poolCurrent : poolTotal;
                
                if (rollValue < 1 || rollValue > 12) {
                    console.log("Cannot roll pool - value must be between 1 and 12");
                    return;
                }
                
                const apiCommand = `!grimpool ${rollValue} ${poolName}`;
                startRoll(apiCommand, function(results) {
                    finishRoll(results.rollId, {});
                });
            });
        } else {
            getAttrs([
                `repeating_pools_${rowId}_pool_name`,
                `repeating_pools_${rowId}_pool_total`,
                `repeating_pools_${rowId}_pool_current`,
                'character_name'
            ], function(values) {
                const poolName = values[`repeating_pools_${rowId}_pool_name`] || 'Custom Pool';
                const poolTotal = parseInt(values[`repeating_pools_${rowId}_pool_total`]) || 0;
                const poolCurrent = parseInt(values[`repeating_pools_${rowId}_pool_current`]) || 0;
                const characterName = values.character_name || 'Character';
                
                let rollValue = poolCurrent > 0 ? poolCurrent : poolTotal;
                
                if (rollValue < 1 || rollValue > 12) {
                    console.log("Cannot roll pool - value must be between 1 and 12");
                    return;
                }
                
                let rollString = `&{template:grimwild-basic} {{rollname=${characterName} | ${poolName} Pool}} `;
                rollString += `{{main_dice=`;
                for (let i = 0; i < rollValue; i++) {
                    if (i > 0) rollString += ` `;
                    rollString += `[[1d6]]`;
                }
                rollString += `}} {{pool_size=${rollValue}}}`;
                
                startRoll(rollString, function(results) {
                    finishRoll(results.rollId, {});
                });
            });
        }
    });
});
	on('clicked:toggle_spell_source_resize', function() {
		getAttrs(['spell_source_resize_unlocked'], function(values) {
			const isCurrentlyUnlocked = values.spell_source_resize_unlocked === 'true';
			const newState = isCurrentlyUnlocked ? 'false' : 'true';
			
			setAttrs({
				spell_source_resize_unlocked: newState
			});
			
			console.log('Spell Source resize mode toggled to:', newState === 'true' ? 'UNLOCKED' : 'LOCKED');
		});
	});

	on('clicked:toggle_spells_resize', function() {
		getAttrs(['spells_resize_unlocked'], function(values) {
			const isCurrentlyUnlocked = values.spells_resize_unlocked === 'true';
			const newState = isCurrentlyUnlocked ? 'false' : 'true';
			
			setAttrs({
				spells_resize_unlocked: newState
			});
			
			console.log('Spells resize mode toggled to:', newState === 'true' ? 'UNLOCKED' : 'LOCKED');
		});
	});
function rollAttribute(attributeName) {
    const attrs = [
        attributeName, 'extra_dice', 'using_spark', 'thorns', 
        `${attributeName}_marked`, 'bloodied', 'rattled', 'character_name', 'use_rollable_tables'
    ];
    
    getAttrs(attrs, function(values) {
        const baseDice = parseInt(values[attributeName]) || 0;
        const extraDice = parseInt(values.extra_dice) || 0;
        const sparkDice = values.using_spark === 'on' ? 1 : 0;
        const mainDiceTotal = baseDice + extraDice + sparkDice;
        
        const baseThorns = parseInt(values.thorns) || 0;
        const markThorns = values[`${attributeName}_marked`] === 'on' ? 1 : 0;
        const bloodiedThorns = values.bloodied === 'on' ? 1 : 0;
        const rattledThorns = values.rattled === 'on' ? 1 : 0;
        const thornTotal = baseThorns + markThorns + bloodiedThorns + rattledThorns;
        const attributeTitle = attributeName.charAt(0).toUpperCase() + attributeName.slice(1);
        
        const useRollableTables = values.use_rollable_tables === 'on';
        
		let rollString = `&{template:grimwild-basic} {{rollname=${values.character_name} | ${attributeTitle} Roll}} `;
		if (useRollableTables) {
			rollString += `{{use_rollable_tables=1}} `;
		}
        
        if (mainDiceTotal > 0) {
            rollString += `{{main_dice=`;
            for (let i = 0; i < mainDiceTotal; i++) {
                if (i > 0) rollString += ` `;
                if (useRollableTables) {
                    rollString += `[[1t[GWRoll]]]`;  // Rollable table version
                } else {
                    rollString += `[[1d6]]`;         // Simple dice version
                }
            }
            rollString += `}} `;
        }
        
        if (thornTotal > 0) {
            rollString += `{{thorns=`;
            for (let i = 0; i < thornTotal; i++) {
                if (i > 0) rollString += ` `;
                if (useRollableTables) {
                    rollString += `[[1t[Thorn]]]`;   // Rollable table version
                } else {
                    rollString += `[[1d8]]`;         // Simple dice version (thorns are d8)
                }
            }
            rollString += `}}`;
        }
        
        startRoll(rollString, function(results) {
            finishRoll(results.rollId, {});
            
            let attrsToSet = {};
            
            if (values[`${attributeName}_marked`] === 'on') {
                attrsToSet[`${attributeName}_marked`] = '0';
            }
            if (values.using_spark === 'on') {
                attrsToSet.using_spark = '0';
            }
            
            if (Object.keys(attrsToSet).length > 0) {
                setAttrs(attrsToSet);
            }
        });
    });
}

on('clicked:roll_brawn_advanced', function() {
    rollAttribute('brawn');
});

on('clicked:roll_agility_advanced', function() {
    rollAttribute('agility');
});

on('clicked:roll_wits_advanced', function() {
    rollAttribute('wits');
});

on('clicked:roll_presence_advanced', function() {
    rollAttribute('presence');
});

on('clicked:roll_story_advanced', function() {
    getAttrs(['extra_dice', 'using_spark', 'thorns', 'bloodied', 'rattled', 'character_name'], function(values) {
        const extraDice = parseInt(values.extra_dice) || 0;
        const sparkDice = values.using_spark === 'on' ? 1 : 0;
        const mainDiceTotal = extraDice + sparkDice;
        
        const baseThorns = parseInt(values.thorns) || 0;
        const bloodiedThorns = values.bloodied === 'on' ? 1 : 0;
        const rattledThorns = values.rattled === 'on' ? 1 : 0;
        const thornTotal = baseThorns + bloodiedThorns + rattledThorns;
        
        let rollString = `&{template:grimwild-basic} {{rollname=${values.character_name} | Story}} `;
        
        if (mainDiceTotal > 0) {
            rollString += `{{main_dice=`;
            for (let i = 0; i < mainDiceTotal; i++) {
                if (i > 0) rollString += ` `;
                rollString += `[[1t[GWRoll]]]`;
            }
            rollString += `}} `;
        }
        
        if (thornTotal > 0) {
            rollString += `{{thorns=`;
            for (let i = 0; i < thornTotal; i++) {
                if (i > 0) rollString += ` `;
                rollString += `[[1t[Thorn]]]`;
            }
            rollString += `}}`;
        }
        
        startRoll(rollString, function(results) {
            finishRoll(results.rollId, {});
   
            if (values.using_spark === 'on') {
                setAttrs({
                    using_spark: '0'
                });
            }
        });
    });
});
on('clicked:roll_pool_advanced', function() {
    getAttrs(['pool_value', 'character_name', 'use_rollable_tables'], function(values) {
        const poolSize = parseInt(values.pool_value) || 0;
        const useRollableTables = values.use_rollable_tables === 'on';
        
        if (poolSize < 1) {
            console.log("Cannot roll pool - pool value must be at least 1");
            return;
        }
        
        if (poolSize > 12) {
            console.log("Cannot roll pool - maximum pool size is 12");
            return;
        }
        
        let rollString = `&{template:grimwild-basic} {{rollname=${values.character_name} | Pool}} `;
        
        rollString += `{{main_dice=`;
        for (let i = 0; i < poolSize; i++) {
            if (i > 0) rollString += ` `;
            rollString += useRollableTables ? `[[1t[GWRoll]]]` : `[[1d6]]`;
        }
        rollString += `}} `;
        
        rollString += `{{pool_size=${poolSize}}} `;
        
        startRoll(rollString, function(results) {
            finishRoll(results.rollId, {});
        });
    });
});
	function rollStoryAdvanced() {
		getAttrs(['extra_dice', 'using_spark', 'thorns', 'character_name', 'use_rollable_tables', 'clean_story_assist'], function(values) {
			const extraDice = parseInt(values.extra_dice) || 0;
			const sparkDice = values.using_spark === 'on' ? 1 : 0;
			const baseThorns = parseInt(values.thorns) || 0;
			const thornTotal = baseThorns; 
			const characterName = values.character_name || 'Character';
			
			const cleanMode = values.clean_story_assist === 'on';
			const additionalDice = cleanMode ? 0 : (extraDice + sparkDice);
			const useRollableTables = values.use_rollable_tables === 'on';
			
			let rollString = '&{template:grimwild-basic} ';
			rollString += '{{rollname=' + characterName + ' | Story Roll}} ';
			if (useRollableTables) {
				rollString += '{{use_rollable_tables=1}} ';
			}
			rollString += '{{main_dice=?{Story Roll Type';
			
			const diceNotation = useRollableTables ? '[[1t[GWRoll]]]' : '[[1d6]]';
			const additionalDiceString = useRollableTables ? ' [[1t[GWRoll]]]' : ' [[1d6]]';
			
			rollString += '|Bad Odds (' + (1 + additionalDice) + 'd),' + diceNotation;
			for (let i = 0; i < additionalDice; i++) {
				rollString += additionalDiceString;
			}
			
			rollString += '|Even Odds (' + (2 + additionalDice) + 'd),' + diceNotation + ' ' + diceNotation;
			for (let i = 0; i < additionalDice; i++) {
				rollString += additionalDiceString;
			}
			
			rollString += '|Good Odds (' + (3 + additionalDice) + 'd),' + diceNotation + ' ' + diceNotation + ' ' + diceNotation;
			for (let i = 0; i < additionalDice; i++) {
				rollString += additionalDiceString;
			}
			
			rollString += '|Montage (' + (2 + additionalDice) + 'd),' + diceNotation + ' ' + diceNotation;
			for (let i = 0; i < additionalDice; i++) {
				rollString += additionalDiceString;
			}
			
			rollString += '}}} ';
			
			if (thornTotal > 0 && !cleanMode) {
				const thornNotation = useRollableTables ? '[[1t[Thorn]]]' : '[[1d8]]';
				rollString += '{{thorns=';
				for (let i = 0; i < thornTotal; i++) {
					if (i > 0) rollString += ' ';
					rollString += thornNotation;
				}
				rollString += '}}';
			}
			
			startRoll(rollString, function(results) {
				finishRoll(results.rollId, {});
				
				if (values.using_spark === 'on' && !cleanMode) {
					setAttrs({ using_spark: '0' });
				}
			});
		});
	}
on('clicked:roll_dropped', function() {
    getAttrs(['use_api_rolls', 'use_rollable_tables', 'clean_story_assist'], function(values) {
        const useAPI = values.use_api_rolls === 'on';
        const cleanMode = values.clean_story_assist === 'on';
        
        if (useAPI) {
            if (cleanMode) {
                const apiCommand = `!grimwild 2 t0 Dropped d0 m0 e0`;
                
                startRoll(apiCommand, function(results) {
                    finishRoll(results.rollId, {});
                });
            } else {
                getAttrs(['thorns', 'extra_dice', 'using_spark'], function(rollValues) {
                    const difficultyThorns = +rollValues.thorns || 0;
                    const extraDice = +rollValues.extra_dice || 0;
                    const usingSpark = rollValues.using_spark === 'on';
                    
                    let totalDice = 2 + extraDice;
                    if (usingSpark) totalDice += 1;
                    
                    let apiCommand = `!grimwild ${totalDice} t${difficultyThorns} Dropped d${difficultyThorns} m0 e${extraDice}`;
                    if (usingSpark) apiCommand += ` spark`;
                    
                    startRoll(apiCommand, function(results) {
                        finishRoll(results.rollId, {});
                        
                        if (usingSpark) {
                            setAttrs({ using_spark: '0' });
                        }
                    });
                });
            }
        } else {
            getAttrs(['character_name'], function(rollValues) {
                const useRollableTables = values.use_rollable_tables === 'on';
                
                let rollString = `&{template:grimwild-basic} {{rollname=${rollValues.character_name} | Dropped Roll}} `;
                if (useRollableTables) {
                    rollString += `{{use_rollable_tables=1}} `;
                }
                
                rollString += `{{main_dice=`;
                const diceNotation = useRollableTables ? `[[1t[GWRoll]]]` : `[[1d6]]`;
                rollString += `${diceNotation} ${diceNotation}`;  // Always exactly 2 dice
                rollString += `}}`;
                
                startRoll(rollString, function(results) {
                    finishRoll(results.rollId, {});
                });
            });
        }
    });
});
	</script>
<rolltemplate class="sheet-rolltemplate-grimwild">
    <div class="sheet-container">
		<div class="sheet-container-header">
			{{charactername}} | {{#poolroll}}{{#rollname}}{{rollname}} Pool{{/rollname}}{{^rollname}}Pool Roll{{/rollname}}{{/poolroll}}{{^poolroll}}{{rollname}} Roll{{/poolroll}}
		</div>
        <div class="sheet-container-content">
            {{^poolroll}}
            <div class="sheet-dice-row-container">
                <div class="sheet-dice-header-left">{{poolname}}
                    <div class="sheet-top-dice-row-left">
                        {{#dice1}}<div class="sheet-dice sheet-dice{{dice1}}">{{dice1}}</div>{{/dice1}}
                        {{#dice2}}<div class="sheet-dice sheet-dice{{dice2}}">{{dice2}}</div>{{/dice2}}
                        {{#dice3}}<div class="sheet-dice sheet-dice{{dice3}}">{{dice3}}</div>{{/dice3}}
                        {{#dice4}}<div class="sheet-dice sheet-dice{{dice4}}">{{dice4}}</div>{{/dice4}}
                        {{#dice5}}<div class="sheet-dice sheet-dice{{dice5}}">{{dice5}}</div>{{/dice5}}
                        {{#dice6}}<div class="sheet-dice sheet-dice{{dice6}}">{{dice6}}</div>{{/dice6}}
                        {{#dice7}}<div class="sheet-dice sheet-dice{{dice7}}">{{dice7}}</div>{{/dice7}}
                        {{#dice8}}<div class="sheet-dice sheet-dice{{dice8}}">{{dice8}}</div>{{/dice8}}
                    </div>        
                </div>
                {{#spark}}     
                <div class="sheet-dice-header-right">Add Spark
                    <div class="sheet-top-dice-row-right">
                        {{#spark1}}<div class="sheet-dice sheet-dice{{spark1}}">{{spark1}}</div>{{/spark1}}
                        {{#spark2}}<div class="sheet-dice sheet-dice{{spark2}}">{{spark2}}</div>{{/spark2}}
                    </div>        
                </div>
                {{/spark}}
            </div>
            {{/poolroll}}
            
            {{#poolroll}}
            <div class="sheet-dice-row-container">
                <div class="sheet-dice-header-left">{{poolname}}
                    <div class="sheet-top-dice-row-left sheet-pool-dice">
                        {{#dice1}}<div class="sheet-dice sheet-dice{{dice1}}">{{dice1}}</div>{{/dice1}}
                        {{#dice2}}<div class="sheet-dice sheet-dice{{dice2}}">{{dice2}}</div>{{/dice2}}
                        {{#dice3}}<div class="sheet-dice sheet-dice{{dice3}}">{{dice3}}</div>{{/dice3}}
                        {{#dice4}}<div class="sheet-dice sheet-dice{{dice4}}">{{dice4}}</div>{{/dice4}}
                        {{#dice5}}<div class="sheet-dice sheet-dice{{dice5}}">{{dice5}}</div>{{/dice5}}
                        {{#dice6}}<div class="sheet-dice sheet-dice{{dice6}}">{{dice6}}</div>{{/dice6}}
                        {{#dice7}}<div class="sheet-dice sheet-dice{{dice7}}">{{dice7}}</div>{{/dice7}}
                        {{#dice8}}<div class="sheet-dice sheet-dice{{dice8}}">{{dice8}}</div>{{/dice8}}
                        {{#dice9}}<div class="sheet-dice sheet-dice{{dice9}}">{{dice9}}</div>{{/dice9}}
                        {{#dice10}}<div class="sheet-dice sheet-dice{{dice10}}">{{dice10}}</div>{{/dice10}}
                        {{#dice11}}<div class="sheet-dice sheet-dice{{dice11}}">{{dice11}}</div>{{/dice11}}
                        {{#dice12}}<div class="sheet-dice sheet-dice{{dice12}}">{{dice12}}</div>{{/dice12}}
                    </div>        
                </div>
            </div>
            {{/poolroll}}
            
            {{#thorns}}
            <div class="sheet-divider"></div>
            <div class="sheet-dice-row-container">
                <div class="sheet-dice-header-left">Difficulty
                    <div class="sheet-top-dice-row-left">
                        {{#thorn1}}<div class="sheet-dice-thorn"><div class="sheet-dice-thorn_text sheet-thorn{{thorn1}}">{{thorn1}}</div></div>{{/thorn1}}
                        {{#thorn2}}<div class="sheet-dice-thorn"><div class="sheet-dice-thorn_text sheet-thorn{{thorn2}}">{{thorn2}}</div></div>{{/thorn2}}
                        {{#thorn3}}<div class="sheet-dice-thorn"><div class="sheet-dice-thorn_text sheet-thorn{{thorn3}}">{{thorn3}}</div></div>{{/thorn3}}
                        {{#thorn4}}<div class="sheet-dice-thorn"><div class="sheet-dice-thorn_text sheet-thorn{{thorn4}}">{{thorn4}}</div></div>{{/thorn4}}
                    </div>        
                </div>
                {{#markharm}}     
                <div class="sheet-dice-header-right">Marks & Harm
                    <div class="sheet-top-dice-row-right">
                        {{#mark1}}<div class="sheet-dice-thorn"><div class="sheet-dice-thorn_text sheet-thorn{{mark1}}">{{mark1}}</div></div>{{/mark1}}
                        {{#mark2}}<div class="sheet-dice-thorn"><div class="sheet-dice-thorn_text sheet-thorn{{mark2}}">{{mark2}}</div></div>{{/mark2}}
                        {{#mark3}}<div class="sheet-dice-thorn"><div class="sheet-dice-thorn_text sheet-thorn{{mark3}}">{{mark3}}</div></div>{{/mark3}}
                    </div>        
                </div>
                {{/markharm}}
            </div>
            {{/thorns}}
            
            {{#markharmonly}}
            <div class="sheet-divider"></div>
            <div class="sheet-dice-row-container">
                <div class="sheet-dice-header-left">Marks & Harm
                    <div class="sheet-top-dice-row-left {{poolclass}}">
                        {{#mark1}}<div class="sheet-dice-thorn"><div class="sheet-dice-thorn_text sheet-thorn{{mark1}}">{{mark1}}</div></div>{{/mark1}}
                        {{#mark2}}<div class="sheet-dice-thorn"><div class="sheet-dice-thorn_text sheet-thorn{{mark2}}">{{mark2}}</div></div>{{/mark2}}
                        {{#mark3}}<div class="sheet-dice-thorn"><div class="sheet-dice-thorn_text sheet-thorn{{mark3}}">{{mark3}}</div></div>{{/mark3}}
                    </div>        
                </div>
            </div>
            {{/markharmonly}}
            
            {{#result}}
            <div class="sheet-divider"></div>
            <div class="sheet-result-bold">{{resultname}}</div>
            <div class="sheet-result-text">{{resulttext}}</div>
            {{/result}}
            
            {{#status}}
            <div class="sheet-mark-text">{{status}}</div>
            {{/status}}
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-grimwild-simple">
    <div class="sheet-container">
        <div class="sheet-container-header">
            {{charactername}} | {{rollname}} Roll
        </div>
        <div class="sheet-container-content">
            
            {{#maindice}}
            <div class="sheet-dice-row-container">
                <div class="sheet-dice-header-left">Main Dice
                    <div class="sheet-top-dice-row-left">
                        {{maindice}}
                    </div>        
                </div>
            </div>
            {{/maindice}}
            
            {{#thorns}}
            <div class="sheet-divider"></div>
            <div class="sheet-dice-row-container">
                <div class="sheet-dice-header-left">Thorns
                    <div class="sheet-top-dice-row-left">
                        {{thorns}}
                    </div>        
                </div>
            </div>
            {{/thorns}}
            
            {{#result}}
            <div class="sheet-divider"></div>
            <div class="sheet-result-bold">{{resultname}}</div>
            <div class="sheet-result-text">{{resulttext}}</div>
            {{/result}}
            
        </div>
    </div>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-grimwild-basic">
    <div class="sheet-container">
        <div class="sheet-header">
            {{rollname}}
        </div>
        
        {{#main_dice}}
        <div class="sheet-section">
            {{#pool_size}}
            <div class="sheet-section-title">Pool ({{pool_size}}d6)</div>
            {{/pool_size}}
            {{^pool_size}}
            <div class="sheet-section-title">Dice Results</div>
            {{/pool_size}}
            <div class="sheet-results">{{main_dice}}</div>
        </div>
        {{/main_dice}}
        
        {{#thorns}}
        <div class="sheet-section">
            <div class="sheet-section-title">Thorns</div>
            <div class="sheet-results">{{thorns}}</div>
        </div>
        {{/thorns}}
        
		<div class="sheet-instructions">
			{{#pool_size}}
			Guide to Pools:<br>
			{{#use_rollable_tables}}
			• Dice that rolled a 1, 2, or 3 are dropped.<br>
			• Any remaining dice stay in the pool.<br> 
			• Pool is depleted when no dice remain.<br> 
			• Push yourself or spend to remove final die.<br>
			{{/use_rollable_tables}}
			{{^use_rollable_tables}}
			• Dice that rolled a 1, 2, or 3 are dropped.<br>
			• Any remaining dice stay in the pool.<br> 
			• Pool is depleted when no dice remain.<br> 
			• Push yourself or spend to remove final die.<br>
			{{/use_rollable_tables}}
			{{/pool_size}}
			{{^pool_size}}
			Guide to Rolls:<br>
			{{#use_rollable_tables}}
			• 2 Perfects Crit: You do it, choose a bonus.<br>
			• Perfect: You do it, avoid trouble.<br>
			• Messy: You do it, but with trouble.<br>
			• Grim: You fail, with trouble.<br>
			• Disaster: The worst comes to pass.<br>
			• Each "Cut" lowers result tier, except crits.<br>
			{{/use_rollable_tables}}
			{{^use_rollable_tables}}
			• 1-3: Grim | 4-5: Messy | 6: Perfect<br>
			• 2 Perfects Crit: You do it, choose a bonus.<br>
			• Perfect: You do it, avoid trouble.<br>
			• Messy: You do it, but with trouble.<br>
			• Grim: You fail, with trouble.<br>
			• Disaster: The worst comes to pass.<br>
			• Each 7-8 Thorn result cuts results tier by one, except crits.<br>
			{{/use_rollable_tables}}
			{{/pool_size}}
		</div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-grimwild-menu">
    <div class="sheet-container">
        <div class="sheet-container-header">
            {{rollname}}
        </div>
        <div class="sheet-container-content">
            <div class="sheet-menu-title">{{menu_title}}</div>
            <div class="sheet-menu-options">{{menu_options}}</div>
        </div>
    </div>
</rolltemplate>
</body>
</html>
